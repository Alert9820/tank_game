<!DOCTYPE html>
<html>
<head>
  <title>Tank Battle</title>
  <style>
    body {
      margin: 0;
      background: #111;
      color: white;
      text-align: center;
      font-family: Arial;
    }
    canvas {
      background: #222;
      display: block;
      margin: auto;
      border: 2px solid #555;
    }
  </style>
</head>
<body>

<h2>2D Multiplayer Tank Game</h2>
<p>Move: W A S D | Shoot: Click</p>
<canvas id="game" width="800" height="500"></canvas>

<script src="/socket.io/socket.io.js"></script>
<script>
  const socket = io();
  const canvas = document.getElementById("game");
  const ctx = canvas.getContext("2d");

  let players = {};
  let bullets = [];
  let angle = 0;
  const keys = {};

  document.addEventListener("keydown", e => keys[e.key] = true);
  document.addEventListener("keyup", e => keys[e.key] = false);
  canvas.addEventListener("click", () => socket.emit("shoot"));

  socket.on("state", (data) => {
    players = data.players;
    bullets = data.bullets;
  });

  function update() {
    let dx = 0, dy = 0;
    if (keys["w"]) dy = -3;
    if (keys["s"]) dy = 3;
    if (keys["a"]) dx = -3;
    if (keys["d"]) dx = 3;

    if (dx || dy) {
      angle = Math.atan2(dy, dx);
      socket.emit("move", { dx, dy, angle });
    }
  }

  function draw() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);

    Object.values(players).forEach(p => {
      ctx.save();
      ctx.translate(p.x, p.y);
      ctx.rotate(p.angle);
      ctx.fillStyle = "lime";
      ctx.fillRect(-15, -10, 30, 20);
      ctx.restore();

      ctx.fillStyle = "red";
      ctx.fillRect(p.x - 15, p.y - 22, p.hp / 4, 4);
    });

    bullets.forEach(b => {
      ctx.fillStyle = "yellow";
      ctx.fillRect(b.x, b.y, 5, 5);
    });
  }

  function loop() {
    update();
    draw();
    requestAnimationFrame(loop);
  }

  loop();
</script>

</body>
</html>
